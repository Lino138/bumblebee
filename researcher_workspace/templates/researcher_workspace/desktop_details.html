{% extends 'common/base.html' %}
{% load static %}
{% load datetime %}

{% block content %}
{% if user.is_authenticated %}
    {% if projects %}
        <section class="desktop-section bg-secondary hex-bg">
            <div class="desktop-container container">
                <div class="row py-5">
                    <!-- Workspace Information -->
                    <div class="workspace-info col-md-12 col-lg-4">
                        <h6 class="text-white mb-3">
                            WORKSPACE
                            <a href="{% url 'project_edit' project_id=selected_project.id %}" class="btn btn-xs btn-link">
                                <i class="fas fa-pen"></i> Edit
                            </a>
                        </h6>
                        <h1 class="workspace-title h2 text-white mb-3">{{ selected_project.title }}</h1>
                        <p class="workspace-description text-white mb-3">{{ selected_project.description }}</p>
                    </div>
                    <!-- Greeting and VM Selection -->
                    <div class="desktop-info col-md-12 col-lg-8">
                        <p class="lead text-center text-white">Good {% time_of_day %} {{ user.first_name }}!</p>
                        <div id="vm-selector" class="vm-selector">
                            <!-- VM List -->
                            <div class="list-group">
                                {% for vm in vms %}
                                    <button type="button" class="list-group-item list-group-item-action vm-item" data-vm-id="{{ vm.pk }}" data-vm-name="{{ vm.name }}" data-vm-description="{{ vm.description }}" data-vm-logo="{{ vm.logo }}">
                                        <img src="{{ vm.logo }}" alt="{{ vm.name }}" class="vm-logo"> {{ vm.name }}
                                    </button>
                                {% endfor %}
                            </div>
                            <!-- VM Details Section -->
                            <div class="vm-details mt-4">
                                <form method="post" action="{% url 'select_vm' %}">
                                    {% csrf_token %}
                                    <input type="hidden" id="vm_chooser" name="vm_chooser">
                                    <h3 id="vm-name"></h3>
                                    <p id="vm-description"></p>
                                    <img id="vm-logo" src="" alt="VM Logo" style="max-width: 100px;">
                                    <button type="submit" class="btn btn-primary mt-3">Select VM</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    {% else %}
        <div class="container">
            <div class="text-center my-5">
                <h2 class="mb-4">Create a workspace to get started...</h2>
                <a class="btn btn-primary btn-lg" href="{% url 'new_project' %}" role="button" title="Create Project">
                    <span class="btn-label"><i class="fas fa-plus"></i></span> Create Workspace
                </a>
            </div>
        </div>
    {% endif %}
{% endif %}
{% endblock content %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const vmItems = document.querySelectorAll('.vm-item');
    const vmChooser = document.getElementById('vm_chooser');
    const vmName = document.getElementById('vm-name');
    const vmDescription = document.getElementById('vm-description');
    const vmLogo = document.getElementById('vm-logo');

    vmItems.forEach(item => {
        item.addEventListener('click', function () {
            vmChooser.value = this.getAttribute('data-vm-id');
            vmName.textContent = this.getAttribute('data-vm-name');
            vmDescription.textContent = this.getAttribute('data-vm-description');
            vmLogo.src = this.getAttribute('data-vm-logo');
        });
    });
});
</script>
{% endblock script %}
